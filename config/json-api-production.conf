# HTTP JSON API Production Configuration
# This configuration includes TLS, PostgreSQL query store, and secure settings

{
  server {
    address = "127.0.0.1"  # Bind to localhost only; reverse proxy handles external traffic
    port    = 7575         # Internal port; NGINX proxies to this
    # TLS is terminated at the reverse proxy level for better performance
  }

  ledger-api {
    address = "localhost"  # Canton participant host
    port    = 5011         # Canton participant ledger API port
    tls {
      enabled = true
      # Client certificate for JSON API to authenticate with Canton
      cert-chain-file = "config/tls/admin-client.crt"
      private-key-file = "config/tls/admin-client.key"
      # Root CA to verify Canton's server certificate
      trust-collection-file = "config/tls/root-ca.crt"
    }
  }

  # PostgreSQL query store for production (replaces in-memory store)
  query-store {
    base-config {
      user = "json_api"
      password = "json_api_password"
      driver = "org.postgresql.Driver"
      url = "jdbc:postgresql://localhost:5432/json_api_store?sslmode=require"
      pool-size = 16
      idle-timeout = 30s
      connection-timeout = 30s
    }
    start-mode = "create-and-start"
  }

  # Authentication configuration
  auth-config {
    # Must match the scope expected by the participant
    target-scope = "daml_ledger_api"
  }

  # Metrics and monitoring
  metrics-reporter = "prometheus"
  metrics-reporting-interval = 30s
}